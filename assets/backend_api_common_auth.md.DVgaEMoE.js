import{_ as a,c as i,o as e,aG as n}from"./chunks/framework.DytOxJW6.js";const k=JSON.parse('{"title":"인증/토큰 API","description":"","frontmatter":{},"headers":[],"relativePath":"backend/api/common/auth.md","filePath":"backend/api/common/auth.md"}'),l={name:"backend/api/common/auth.md"};function t(o,s,h,p,r,c){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="인증-토큰-api" tabindex="-1">인증/토큰 API <a class="header-anchor" href="#인증-토큰-api" aria-label="Permalink to &quot;인증/토큰 API&quot;">​</a></h1><p>JWT 토큰 재발급을 처리하는 API입니다.</p><h2 id="기본-정보" tabindex="-1">기본 정보 <a class="header-anchor" href="#기본-정보" aria-label="Permalink to &quot;기본 정보&quot;">​</a></h2><ul><li><strong>Base URL</strong>: <code>/api/auth</code></li><li><strong>HTTP Method</strong>: <code>POST</code></li><li><strong>인증</strong>: Refresh Token 쿠키 필요 (인증 제외 URI)</li></ul><h2 id="api-목록" tabindex="-1">API 목록 <a class="header-anchor" href="#api-목록" aria-label="Permalink to &quot;API 목록&quot;">​</a></h2><h3 id="_1-access-token-재발급" tabindex="-1">1. Access Token 재발급 <a class="header-anchor" href="#_1-access-token-재발급" aria-label="Permalink to &quot;1. Access Token 재발급&quot;">​</a></h3><p><strong>엔드포인트:</strong> <code>/api/auth/getAccessToken</code></p><p><strong>설명:</strong> Refresh Token을 사용하여 새로운 Access Token을 발급받습니다.</p><p><strong>요청:</strong></p><ul><li><strong>파라미터</strong>: 없음 (쿠키에서 자동 추출)</li><li><strong>쿠키</strong>: <ul><li><code>refreshToken</code>: 리프레시 토큰 (HttpOnly)</li><li><code>uuid</code>: Redis 키값 (HttpOnly)</li></ul></li></ul><p><strong>동작 순서:</strong></p><ol><li>쿠키에서 <code>refreshToken</code>, <code>uuid</code> 추출</li><li>Refresh Token 검증</li><li>Redis에서 토큰 정보 조회 및 일치 확인</li><li>새로운 Access Token 생성 및 반환</li></ol><p><strong>응답 예시 (성공):</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJVU0VSMDAxIiwidG9rZW5fdHlwZSI6ImFjY2VzcyIsImlhdCI6MTcwNDA2NDgwMCwiZXhwIjoxNzA0MDY1NzAwfQ...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>응답 필드:</strong></p><ul><li><code>accessToken</code> (String): 새로 발급된 액세스 토큰 (유효기간: 15분)</li></ul><p><strong>응답 예시 (실패 - 401):</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;클라이언트에 토큰 없음&quot;</span></span></code></pre></div><p>또는</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;레디스 디비에 토큰 정보가 없습니다&quot;</span></span></code></pre></div><p>또는</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Invalid refresh token&quot;</span></span></code></pre></div><p><strong>사용 예시:</strong></p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 쿠키는 자동으로 전송됨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/auth/getAccessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (response.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> newAccessToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data.accessToken;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 새로운 Access Token을 저장하여 사용</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, newAccessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 토큰이 만료되었거나 유효하지 않음</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 로그인 페이지로 리다이렉트</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="토큰-정보" tabindex="-1">토큰 정보 <a class="header-anchor" href="#토큰-정보" aria-label="Permalink to &quot;토큰 정보&quot;">​</a></h2><h3 id="access-token" tabindex="-1">Access Token <a class="header-anchor" href="#access-token" aria-label="Permalink to &quot;Access Token&quot;">​</a></h3><ul><li><strong>유효기간</strong>: 15분</li><li><strong>용도</strong>: API 인증</li><li><strong>저장 위치</strong>: <ul><li>클라이언트: 메모리 또는 localStorage</li><li>전송: Authorization 헤더</li></ul></li></ul><h3 id="refresh-token" tabindex="-1">Refresh Token <a class="header-anchor" href="#refresh-token" aria-label="Permalink to &quot;Refresh Token&quot;">​</a></h3><ul><li><strong>유효기간</strong>: 7일</li><li><strong>용도</strong>: Access Token 재발급</li><li><strong>저장 위치</strong>: <ul><li>클라이언트: HttpOnly 쿠키</li><li>서버: Redis Hash</li></ul></li></ul><h3 id="uuid" tabindex="-1">UUID <a class="header-anchor" href="#uuid" aria-label="Permalink to &quot;UUID&quot;">​</a></h3><ul><li><strong>용도</strong>: Redis에서 토큰 정보 조회</li><li><strong>저장 위치</strong>: HttpOnly 쿠키</li></ul><h2 id="에러-처리" tabindex="-1">에러 처리 <a class="header-anchor" href="#에러-처리" aria-label="Permalink to &quot;에러 처리&quot;">​</a></h2><h3 id="_401-unauthorized" tabindex="-1">401 Unauthorized <a class="header-anchor" href="#_401-unauthorized" aria-label="Permalink to &quot;401 Unauthorized&quot;">​</a></h3><p>다음 경우에 401 응답이 반환됩니다:</p><ol><li><p><strong>쿠키 없음</strong></p><ul><li><code>refreshToken</code> 쿠키가 없는 경우</li><li><code>uuid</code> 쿠키가 없는 경우</li></ul></li><li><p><strong>토큰 검증 실패</strong></p><ul><li>Refresh Token이 유효하지 않은 경우</li><li>토큰 타입이 일치하지 않는 경우 (Access Token을 전송한 경우)</li><li>사용자 ID가 없는 경우</li></ul></li><li><p><strong>Redis 조회 실패</strong></p><ul><li>Redis에 토큰 정보가 없는 경우</li><li>Redis 토큰과 쿠키 토큰이 일치하지 않는 경우</li></ul></li></ol><h2 id="토큰-재발급-플로우" tabindex="-1">토큰 재발급 플로우 <a class="header-anchor" href="#토큰-재발급-플로우" aria-label="Permalink to &quot;토큰 재발급 플로우&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 클라이언트 → 서버: POST /api/auth/getAccessToken (쿠키 포함)</span></span>
<span class="line"><span>2. 서버: 쿠키에서 refreshToken, uuid 추출</span></span>
<span class="line"><span>3. 서버: Refresh Token 검증</span></span>
<span class="line"><span>4. 서버: Redis에서 토큰 정보 조회</span></span>
<span class="line"><span>5. 서버: 토큰 일치 확인</span></span>
<span class="line"><span>6. 서버: 새 Access Token 생성</span></span>
<span class="line"><span>7. 서버 → 클라이언트: 새 Access Token 반환</span></span></code></pre></div><h2 id="주의사항" tabindex="-1">주의사항 <a class="header-anchor" href="#주의사항" aria-label="Permalink to &quot;주의사항&quot;">​</a></h2><ol><li><strong>쿠키 자동 전송</strong>: 쿠키는 브라우저에서 자동으로 전송되므로 별도 설정 불필요</li><li><strong>CORS 설정</strong>: 쿠키 전송을 위해 CORS 설정에서 <code>allowCredentials: true</code> 필요</li><li><strong>토큰 만료</strong>: Refresh Token이 만료되면 다시 로그인해야 합니다.</li><li><strong>보안</strong>: Refresh Token은 HttpOnly 쿠키로 저장되어 JavaScript에서 접근 불가</li></ol><h2 id="다음-단계" tabindex="-1">다음 단계 <a class="header-anchor" href="#다음-단계" aria-label="Permalink to &quot;다음 단계&quot;">​</a></h2><ul><li><a href="./file.html">파일 관리 API</a></li><li><a href="./../ess/login.html">로그인 API</a></li></ul>`,42)]))}const g=a(l,[["render",t]]);export{k as __pageData,g as default};
